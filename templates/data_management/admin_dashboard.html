{% extends 'base.html' %}

{% block title %}Admin Dashboard | ZeroTrustVault{% endblock %}

{% block content %}
<div style="margin-bottom: 30px;">
    <h2 style="font-size: 24px; font-weight: 700;">Admin Oversight</h2>
</div>

<div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px;">
    <div class="card" style="padding: 24px; border-left: 4px solid var(--primary);">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Total Files</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ total_files }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid #48bb78;">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Registered Users</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ total_users }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid var(--danger);">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Pending Approvals</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ pending_requests }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid var(--warning);">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Total On-Chain Logs</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ total_requests }}</h3>
    </div>
</div>

<div class="card-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <div class="card">
        <h3 class="card-title">ðŸ”” Pending Access Requests</h3>
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
            }

            th {
                text-align: left;
                color: var(--text-secondary);
                font-size: 12px;
                font-weight: 600;
                padding: 12px;
                border-bottom: 1px solid var(--border-color);
            }

            td {
                padding: 12px;
                border-bottom: 1px solid #ffffff05;
                font-size: 13px;
            }

            .badge-pending {
                color: var(--warning);
                background: #ed893615;
            }
        </style>
        <table>
            <thead>
                <tr>
                    <th>USER</th>
                    <th>DATA</th>
                    <th>STATUS</th>
                    <th>ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for req in recent_requests %}
                <tr>
                    <td style="color: var(--text-main);">{{ req.user.username }}</td>
                    <td style="color: var(--text-secondary);">{{ req.data_file.title|truncatechars:15 }}</td>
                    <td><span class="badge badge-pending">PENDING</span></td>
                    <td>
                        {% if req.status == 'pending' %}
                        <a href="{% url 'data_management:process_request' req.request_id %}" class="btn btn-primary"
                            style="padding: 4px 12px; font-size: 11px;">Review</a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 30px;">No pending
                        requests.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div style="text-align: right; margin-top: 20px;">
            <a href="{% url 'data_management:view_requests' %}"
                style="color: var(--primary); text-decoration: none; font-size: 12px; font-weight: 600;">Full Request
                Log â†’</a>
        </div>
    </div>

    <div class="card">
        <h3 class="card-title">ðŸ“¤ Vault Storage Status</h3>
        <table>
            <thead>
                <tr>
                    <th>TITLE</th>
                    <th>TYPE</th>
                    <th>SIZE</th>
                    <th>UPLOADED</th>
                </tr>
            </thead>
            <tbody>
                {% for file in recent_uploads %}
                <tr>
                    <td style="color: var(--text-main);">{{ file.title|truncatechars:15 }}</td>
                    <td><span style="color: var(--primary); font-size: 11px; font-weight: 700;">{{ file.file_type|upper
                            }}</span></td>
                    <td style="color: var(--text-secondary);">{{ file.file_size|filesizeformat }}</td>
                    <td style="color: var(--text-secondary);">{{ file.uploaded_at|date:"M d" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 30px;">No files in
                        vault yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div style="text-align: right; margin-top: 20px;">
            <a href="{% url 'data_management:view_data' %}"
                style="color: var(--primary); text-decoration: none; font-size: 12px; font-weight: 600;">Vault Inventory
                â†’</a>
        </div>
    </div>
</div>
{% endblock %}