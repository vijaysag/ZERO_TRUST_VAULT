{% extends 'base.html' %}

{% block title %}Dashboard | ZeroTrustVault{% endblock %}

{% block content %}
<div style="margin-bottom: 30px;">
    <h2 style="font-size: 24px; font-weight: 700;">Dashboard Overview</h2>
</div>

<div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px;">
    <div class="card" style="padding: 24px; border-left: 4px solid #4299e1;">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Pending Requests</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ pending_count }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid #48bb78;">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Approved Access</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ approved_count }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid #ed8936;">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Documents Accessed</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ accessed_count }}</h3>
    </div>
    <div class="card" style="padding: 24px; border-left: 4px solid var(--primary);">
        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">Available Files</p>
        <h3 style="font-size: 28px; font-weight: 700;">{{ available_files }}</h3>
    </div>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h3 class="card-title" style="margin-bottom: 0;">üìù Recent Activity</h3>
        <a href="{% url 'access_control:browse_data' %}" class="btn btn-primary" style="font-size: 14px;">Browse New
            Data</a>
    </div>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #ffffff05;
            font-size: 14px;
        }

        .badge-pending {
            color: var(--warning);
            background: #ed893615;
        }

        .badge-approved {
            color: var(--success);
            background: #48bb7815;
        }

        .badge-accessed {
            color: var(--primary);
            background: #805ad515;
        }
    </style>

    <table>
        <thead>
            <tr>
                <th>DATA FILE</th>
                <th>REQUESTED AT</th>
                <th>STATUS</th>
                <th>CHAIN AUTH</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>
            {% for req in recent_requests %}
            <tr>
                <td><strong style="color: var(--text-main);">{{ req.data_file.title }}</strong></td>
                <td style="color: var(--text-secondary);">{{ req.requested_at|date:"M d, H:i" }}</td>
                <td><span class="badge badge-{{ req.status }}">{{ req.status|upper }}</span></td>
                <td>
                    {% if req.blockchain_request_tx %}
                    <span title="{{ req.blockchain_request_tx }}"
                        style="font-size: 11px; color: var(--success);">VERIFIED ‚úÖ</span>
                    {% else %}
                    <span style="font-size: 11px; color: var(--text-secondary); opacity: 0.5;">PENDING...</span>
                    {% endif %}
                </td>
                <td>
                    {% if req.status == 'approved' %}
                    <a href="{% url 'access_control:view_data_with_otp' req.request_id %}" class="btn btn-primary"
                        style="padding: 6px 14px; font-size: 12px;">Unlock Data</a>
                    {% elif req.status == 'accessed' %}
                    <a href="{% url 'access_control:view_data_with_otp' req.request_id %}" class="btn btn-outline"
                        style="padding: 6px 14px; font-size: 12px;">Review Log</a>
                    {% else %}
                    <span style="color: var(--text-secondary); font-size: 12px;">Awaiting Review</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: var(--text-secondary); padding: 40px;">You haven't
                    requested any data yet. Start by browsing the vault.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div style="text-align: right; margin-top: 20px;">
        <a href="{% url 'access_control:my_requests' %}"
            style="color: var(--primary); text-decoration: none; font-size: 13px; font-weight: 600;">View All Requests
            ‚Üí</a>
    </div>
</div>
{% endblock %}